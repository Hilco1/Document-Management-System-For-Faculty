{% extends "base.html" %}
{% block content %}

<style>

/* ===== SUMMARY (2 CLEAN LINES) ===== */
.document-summary {
    color: #4b5563;
    font-size: 0.95rem;
    line-height: 1.5;

    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;

    overflow: hidden;
    text-overflow: ellipsis;
    min-height: 48px;
}

/* ===== TAG CONTAINER (ONE LINE) ===== */
.tag-container {
    margin-top: 12px;
    display: flex;
    gap: 8px;
    flex-wrap: wrap;       
    max-height: 38px;       
    overflow: hidden;       
}

/* ===== CLEAN PROFESSIONAL TAGS ===== */
.tag {
    background-color: #0ea5e9;
    color: white;
    padding: 6px 14px;
    font-size: 0.75rem;
    font-weight: 500;
    border-radius: 999px;
    white-space: nowrap;
    transition: background-color 0.2s ease, box-shadow 0.2s ease;
}

/* subtle professional hover (no movement) */
.tag:hover {
    background-color: #0284c7;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
}

</style>

<div class="container mt-4">

    <!-- HEADER + SEARCH -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="fw-bold mb-0">
            {{ page_title if page_title else "Dashboard" }}
        </h3>

        <form method="GET" action="{{ url_for('dashboard') }}" class="d-flex mb-3">

    <input type="search"
           name="q"
           class="form-control me-2"
           placeholder="Search..."
           value="{{ q if q else '' }}">

    <button class="btn btn-primary">
        Search
    </button>

</form>
    </div>

    <!-- FILTERS -->
    {% if current_user.role in ['admin', 'professor', 'assistant'] %}
    <div class="mb-4 fw-semibold" style="font-size:1.05rem; letter-spacing:0.3px;">

        <a href="{{ url_for(current_view, status='all') }}"
           class="text-secondary text-decoration-none me-3">
            All
        </a>

        <span class="text-muted">|</span>

        <a href="{{ url_for(current_view, status='approved') }}"
           class="text-success text-decoration-none mx-3">
            Approved
        </a>

        <span class="text-muted">|</span>

        <a href="{{ url_for(current_view, status='pending') }}"
           class="text-warning text-decoration-none mx-3">
            Pending
        </a>

        <span class="text-muted">|</span>

        <a href="{{ url_for(current_view, status='rejected') }}"
           class="text-danger text-decoration-none ms-3">
            Rejected
        </a>

    </div>
    {% endif %}

    {% if docs|length == 0 %}
    <div class="alert alert-info">No documents found.</div>
    {% endif %}

    {% for d in docs %}
    <div class="card mb-3 shadow-sm border-0" style="border-radius:12px;">
        <div class="card-body">

            <!-- TOP ROW -->
            <div class="d-flex justify-content-between align-items-start mb-2">

                <!-- LEFT SIDE -->
                <div class="d-flex align-items-center">

                    <h5 class="mb-0 fw-semibold me-2">
                        {{ d.filename.replace('_', ' ').replace('-', ' ').replace('.pdf', '') }}
                    </h5>

                    <span class="badge
                        {% if d.status == 'approved' %}
                            bg-success
                        {% elif d.status == 'pending' %}
                            bg-warning text-white
                        {% elif d.status == 'rejected' %}
                            bg-danger
                        {% endif %}
                    ">
                        {{ d.status|capitalize }}
                    </span>

                </div>

                <!-- VERSION -->
                <span class="badge rounded-pill px-3 py-2"
                      style="background-color:#f1f3f5; color:#495057; font-weight:600;">
                    v{{ d.version }}
                </span>

            </div>

            <!-- DATE -->
            {% if d.status in ['approved','rejected'] and d.approved_at %}
                <small class="text-muted d-block mb-2">
                    {{ d.status|capitalize }} on {{ d.approved_at.strftime('%d %b %Y') }}
                </small>
            {% endif %}

            <!-- REJECTION REASON -->
            {% if d.status == 'rejected' and d.rejection_reason %}
                <div class="alert alert-danger mt-2 p-2">
                    <strong>Reason:</strong> {{ d.rejection_reason }}
                </div>
            {% endif %}

            <!-- SUMMARY (2 LINE LIMIT) -->
            {% if d.summary %}
            <p class="document-summary">
                {{ d.summary }}
            </p>
            {% endif %}

            <!-- TAGS (SINGLE ROW) -->
            {% if d.tags %}
            <div class="tag-container">
                {% for tag in d.tags.split(',') %}
                    <span class="tag">
                        {{ tag.strip().capitalize() }}
                    </span>
                {% endfor %}
            </div>
            {% endif %}

            <!-- BUTTONS -->
            <div class="mt-3">
                <a href="{{ url_for('file_view', filename=d.filename) }}"
                   target="_blank"
                   class="btn btn-sm btn-primary">
                   Open
                </a>

                {% if current_user.role == 'admin' and d.status == 'pending' %}
                    <a href="{{ url_for('approve', doc_id=d.id) }}"
                       class="btn btn-success btn-sm ms-2">
                       Approve
                    </a>

                    <a href="{{ url_for('reject', doc_id=d.id) }}"
                       class="btn btn-danger btn-sm ms-1">
                       Reject
                    </a>
                {% endif %}
            </div>

        </div>
    </div>
    {% endfor %}

</div>

{% endblock %}